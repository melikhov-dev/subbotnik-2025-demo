# AI BI Analyst - Demo

–î–µ–º–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ–∫–ª–∞–¥–∞

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —á–∞—Ç–æ–º –∏ –≤—ã–∑–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –ø—Å–µ–≤–¥–æ BI –∞–Ω–∞–ª–∏–∑–∞ –¥–∞—à–±–æ—Ä–¥–∞ –ø—Ä–æ–¥–∞–∂.

- **Frontend**: React + Vite + Gravity UI Kit + TypeScript
- **Backend**: Node.js + Express + TypeScript
- **API**: OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API (OpenAI, Azure, Yandex, –∏ –¥—Ä.)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üí¨ –ß–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å AI
- üîß Function calling (—Ç—É–ª `getChartData`)
- üìä –°—Ç–∞—Ç–∏—á–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö
- ‚ö° Streaming –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç AI
- üëÅÔ∏è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
subbotnik-demo/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ client/    # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ server/    # Node.js —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ shared/    # –û–±—â–∏–µ —Ç–∏–ø—ã TypeScript
‚îî‚îÄ‚îÄ package.json   # Root –º–æ–Ω–æ—Ä–µ–ø–æ
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 24.0.0 (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–ª–∞–≥ `--env-file`)
- npm

### –®–∞–≥–∏

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:

```bash
cd subbotnik-demo
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
```

3. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cp .env.example .env
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:

```env
# –î–ª—è OpenAI
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4

# –î–ª—è Yandex Foundation Models
# OPENAI_API_KEY=your_yandex_api_key
# OPENAI_BASE_URL=https://llm.api.cloud.yandex.net/v1
# OPENAI_MODEL=gpt://<–∏–º—è —Ñ–æ–ª–¥–µ—Ä–∞>/<–∏–º—è –º–æ–¥–µ–ª–∏>/latest

# –î–ª—è Azure OpenAI
# OPENAI_API_KEY=your_azure_api_key
# OPENAI_BASE_URL=https://your-resource.openai.azure.com/
# OPENAI_MODEL=gpt-4

PORT=3001
```

## –ó–∞–ø—É—Å–∫

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

```bash
npm run dev
```

–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:

```bash
# –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç (–ø–æ—Ä—Ç 3000)
npm run dev:client

# –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 3001)
npm run dev:server
```

### –î–æ—Å—Ç—É–ø

- **–ö–ª–∏–µ–Ω—Ç**: http://localhost:3000
- **–°–µ—Ä–≤–µ—Ä API**: http://localhost:3001

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –£–≤–∏–¥–∏—Ç–µ –¥–∞—à–±–æ—Ä–¥ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–¥–∞–∂–∞—Ö —Å–ª–µ–≤–∞ –∏ —á–∞—Ç —Å–ø—Ä–∞–≤–∞
3. –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç, AI –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `getChartData` –∏ –¥–∞—Å—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
4. –í—ã —É–≤–∏–¥–∏—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ–º–æ:

- "–ö–∞–∫–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ?"
- "–°—Ä–∞–≤–Ω–∏ –ø—Ä–æ–¥–∞–∂–∏ —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞"
- "–ü–æ–∫–∞–∂–∏ —Ç–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ"
- "–ö–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–∏–Ω–æ—Å–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –¥–æ—Ö–æ–¥–∞?"
- "–ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –¥–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂?"

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–ª–∏–µ–Ω—Ç (React)

- `Dashboard.tsx` - —Å—Ç–∞—Ç–∏—á–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø—Ä–æ–¥–∞–∂
- `Chat.tsx` - —á–∞—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- `ChatMessage.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `api/chat.ts` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è fetch streaming

### –°–µ—Ä–≤–µ—Ä (Node.js)

- `chat/handler.ts` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ POST /api/chat —Å streaming
- `chat/llmClient.ts` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö API
- `tools/getChartData.ts` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É–ª–∞
- `tools/registry.ts` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—É–ª–æ–≤
- `data/mockData.ts` - –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### Shared

- `types.ts` - –æ–±—â–∏–µ TypeScript —Ç–∏–ø—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞

## API Endpoint

### POST /api/chat

**Request:**
```json
{
  "messages": [
    { "role": "user", "content": "–ö–∞–∫–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ?" }
  ]
}
```

**Response:** Chunked streaming (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = JSON —Å–æ–±—ã—Ç–∏–µ)

```
{"type":"function-call","data":{"name":"getChartData","arguments":{"chartId":"sales-current-month"}}}
{"type":"function-result","data":{"chartId":"sales-current-month","total":552000,...}}
{"type":"message-delta","data":"–í"}
{"type":"message-delta","data":" —ç—Ç–æ–º"}
{"type":"message-delta","data":" –º–µ—Å—è—Ü–µ"}
...
{"type":"done"}
```

## Function Calling

### getChartData

–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chartId` (string) - ID –≥—Ä–∞—Ñ–∏–∫–∞. –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
  - `"sales-current-month"` - –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü (–ø–æ –¥–Ω—è–º)
  - `"sales-previous-month"` - –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü (–ø–æ –¥–Ω—è–º)
  - `"revenue-by-category"` - –¥–æ—Ö–æ–¥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç–æ–≤–∞—Ä–æ–≤
  - `"top-products"` - —Ç–æ–ø-5 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º

**–í–æ–∑–≤—Ä–∞—Ç:**
```typescript
{
  chartId: string;
  period: string;
  data: Array<{ date: string; sales: number; orders: number }>;
  total: number;
  avgDaily: number;
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- AI –º–æ–∂–µ—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å `sales-current-month` –∏ `sales-previous-month` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏
- AI –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∞–º—É—é –ø—Ä–∏–±—ã–ª—å–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ `revenue-by-category`
- AI –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ `top-products`

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–±–æ—Ä–∫–∞

```bash
npm run build
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–Ω–æ—Ä–µ–ø–æ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç npm workspaces –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–Ω–æ—Ä–µ–ø–æ. –û–±—â–∏–µ —Ç–∏–ø—ã –∏–∑ `@subbotnik/shared` –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ –≤ –∫–ª–∏–µ–Ω—Ç–µ, —Ç–∞–∫ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
